<!DOCTYPE html>
<html>
  <head>
    <title>React App</title>
    <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
  </head>
  <style>
    .label {
      fill: rgb(108, 108, 108);
      font-family: Arial, Helvetica, sans-serif;
      font-size: 18px;
      text-anchor: middle;
      background-color: rgb(255, 255, 255, 0.8) !important;
      border-radius: 5px;
      padding: 5px;
    }
  </style>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useEffect, useRef, useState } = React;

      const ratingsLabels = [
        "Vision",
        "Concept development",
        "Value proposition",
        "Contextual research",
        "User research",
        "Market research",
        "Information architecture",
        "User flow",
        "Behaviour",
        "Graphic design",
        "Data visualisation",
        "Specifications",
        "Mock-up",
        "Interactive prototype",
        "Front-end development",
        "Hardware",
        "Testing",
      ];

      const colors = [
        "#6A2B8B", // Dark Orchid
        "#864C9E", // Medium Purple
        "#9C69AC", // Medium Orchid
        "#CB2026", // Firebrick
        "#EF4749", // Indian Red
        "#F37D80", // Light Coral
        "#CA6E28", // Chocolate
        "#F6881F", // Dark Orange
        "#FDBA34", // Goldenrod
        "#FFD700", // Gold
        "#446630", // Dark Olive Green
        "#688E23", // Olive Drab
        "#659A41", // Yellow Green
        "#98CA3C", // Lime Green
        "#0099CD", // Deep Sky Blue
        "#34B5E3", // Sky Blue
        "#B21E5B", // Medium Violet Red
        "#E50F73", // Deep Pink
        "#EE3B95", // Hot Pink
        "#FF69B4", // Hot Pink
      ];

      function App() {
        const [ratings, setRatings] = useState(
          Array(ratingsLabels.length).fill(5)
        );
        const svgRef = useRef();

        useEffect(() => {
          const svg = d3.select(svgRef.current);
          svg.selectAll("*").remove(); // Clear the SVG

          const width = window.innerWidth;
          const height = window.innerHeight;
          const centerX = width / 2;
          const centerY = height / 2;
          const centerRadius = Math.min(centerX, centerY) / 3;
          const padding = 30;

          svg.attr("width", width).attr("height", height);

          const degreesToRadians = (degrees) => (degrees * Math.PI) / 180;
          const sumTo = (a, i) =>
            a.slice(0, i).reduce((acc, val) => acc + val, 0);

          let totalRating = ratings.reduce((a, b) => a + b, 0);

          let accumulatedRating = 0;

          ratings.forEach((rating, i) => {
            const radius =
              centerRadius +
              rating *
                ((Math.min(centerX, centerY) - centerRadius - padding) / 10);
            const startingAngle = (accumulatedRating / totalRating) * 360;
            const arcSize = (rating / totalRating) * 360;
            const endingAngle = startingAngle + arcSize;

            accumulatedRating += rating;

            const largeArcFlag = arcSize <= 180 ? "0" : "1";

            const startX =
              centerX + radius * Math.cos(degreesToRadians(startingAngle));
            const startY =
              centerY + radius * Math.sin(degreesToRadians(startingAngle));
            const endX =
              centerX + radius * Math.cos(degreesToRadians(endingAngle));
            const endY =
              centerY + radius * Math.sin(degreesToRadians(endingAngle));

            const d = [
              "M",
              centerX,
              centerY,
              "L",
              startX,
              startY,
              "A",
              radius,
              radius,
              0,
              largeArcFlag,
              1,
              endX,
              endY,
              "Z",
            ].join(" ");

            svg
              .append("path")
              .attr("d", d)
              .attr("fill", colors[i])
              .attr("stroke", "white")
              .attr("stroke-width", 1);

            const labelRadius = radius + 20;
            const labelX =
              centerX +
              labelRadius *
                Math.cos(degreesToRadians(startingAngle + arcSize / 2));
            const labelY =
              centerY +
              labelRadius *
                Math.sin(degreesToRadians(startingAngle + arcSize / 2));

            const words = ratingsLabels[i].split(" ");
            const numLines = words.length;
            const fontSize = 20;
            const lineHeight = 1.2;

            let textWidth = 0;
            let textHeight = numLines * fontSize * lineHeight;

            const group = svg.append("g");

            const text = group
              .append("text")
              .attr("x", labelX)
              .attr("class", "label");

            words.forEach((word, j) => {
              const tspan = text
                .append("tspan")
                .attr("x", labelX)
                .attr(
                  "dy",
                  j === 0
                    ? `${(-lineHeight * (numLines - 1)) / 2}em`
                    : `${lineHeight}em`
                )
                .text(word);

              textWidth = Math.max(
                textWidth,
                tspan.node().getComputedTextLength()
              );
            });

            const rect = group
              .insert("rect", ":first-child")
              .attr("x", labelX - textWidth / 2 - 5)
              .attr("y", labelY - textHeight / 2 - 5)
              .attr("width", textWidth + 10)
              .attr("height", textHeight + 10)
              .attr("rx", 5)
              .attr("ry", 5)
              .style("fill", "rgba(255, 255, 255, 0.75)");

            text.attr(
              "y",
              parseFloat(rect.attr("y")) +
                parseFloat(rect.attr("height")) / 2 +
                5
            );
          });

          svg
            .append("circle")
            .attr("cx", centerX)
            .attr("cy", centerY)
            .attr("r", centerRadius * 0.8)
            .attr("fill", "white");
        }, [ratings]);

        const handleRatingChange = (index) => (event) => {
          const newRatings = [...ratings];
          newRatings[index] = Number(event.target.value);
          setRatings(newRatings);
        };

        return React.createElement(
          "div",
          { className: "App" },
          ratingsLabels.map((label, index) =>
            React.createElement(
              "div",
              { key: index },
              React.createElement(
                "label",
                { htmlFor: `rating-${index}` },
                label
              ),
              React.createElement("input", {
                id: `rating-${index}`,
                type: "number",
                min: "1",
                max: "10",
                step: "1",
                value: ratings[index],
                onChange: handleRatingChange(index),
              })
            )
          ),
          React.createElement("svg", { ref: svgRef })
        );
      }

      ReactDOM.render(
        React.createElement(App),
        document.getElementById("root")
      );
    </script>
  </body>
</html>
